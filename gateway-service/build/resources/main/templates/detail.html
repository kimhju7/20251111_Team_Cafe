<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        .container { max-width: 800px; margin: auto; }
        h1 { color: #333; }
        .meta { color: gray; font-size: 0.9em; margin-bottom: 20px; }
        textarea, input { width: 100%; margin-top: 10px; }
        button { margin: 5px; padding: 6px 12px; }
        .btn-group { margin-top: 20px; }
    </style>
</head>
<body>
<div class="container">
    <h1 id="title">ì œëª©</h1>
    <div class="meta">
        ì‘ì„±ì: <span id="author"></span> | ì‘ì„±ì¼: <span id="createdAt"></span>
    </div>
    <div id="content" style="white-space: pre-wrap; border: 1px solid #ddd; padding: 15px;"></div>

    <div class="btn-group">
        <button onclick="showEdit()">âœï¸ ìˆ˜ì •</button>
        <button onclick="deletePost()">ğŸ—‘ï¸ ì‚­ì œ</button>
        <a href="/posts" class="button-link">ğŸ“‹ ëª©ë¡ìœ¼ë¡œ</a>
    </div>

    <!-- ìˆ˜ì • í¼ -->
    <div id="editForm" style="display:none; margin-top:20px;">
        <input type="text" id="editTitle" placeholder="ì œëª©">
        <input type="text" id="editAuthor" placeholder="ì‘ì„±ì">
        <textarea id="editContent" rows="6"></textarea>
        <button onclick="saveEdit()">ğŸ’¾ ì €ì¥</button>
        <button onclick="cancelEdit()">ì·¨ì†Œ</button>
    </div>
</div>

<script>
    const id = window.location.pathname.split("/").pop();

    async function loadPost() {
        const res = await fetch(`/api/posts/${id}`);
        const post = await res.json();

        document.getElementById('title').innerText = post.title;
        document.getElementById('author').innerText = post.author;
        document.getElementById('createdAt').innerText = post.createdAt ? post.createdAt.replace('T', ' ') : '';
        document.getElementById('content').innerText = post.content;

        document.getElementById('editTitle').value = post.title;
        document.getElementById('editAuthor').value = post.author;
        document.getElementById('editContent').value = post.content;
    }

    function goBack() {
        window.location.href = "/";
    }

    function showEdit() {
        document.getElementById('editForm').style.display = 'block';
    }

    function cancelEdit() {
        document.getElementById('editForm').style.display = 'none';
    }

    async function saveEdit() {
        const title = document.getElementById('editTitle').value;
        const author = document.getElementById('editAuthor').value;
        const content = document.getElementById('editContent').value;

        const res = await fetch(`/api/posts/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, author, content })
        });

        if (res.ok) {
            alert("ìˆ˜ì • ì™„ë£Œ!");
            document.getElementById('editForm').style.display = 'none';
            loadPost();
        } else {
            alert("ìˆ˜ì • ì‹¤íŒ¨!");
        }
    }

    async function deletePost() {
        if (!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        const res = await fetch(`/api/posts/${id}`, { method: 'DELETE' });
        if (res.ok) {
            alert("ì‚­ì œ ì™„ë£Œ!");
            goBack();
        } else {
            alert("ì‚­ì œ ì‹¤íŒ¨!");
        }
    }

    loadPost();
</script>
</body>
</html>
